---
name: Modules.BLE
extends: Titanium.Module
summary: Add-on Bluetooth Low Energy module
since: "1.0.0"
description: |
    Using Bluetooth Low Energy module is used to interact with Bluetooth Low Energy (BLE) devices.
    Note (IOS): Starting iOS 13, it's mandatory for developers to specify the Privacy Usage Description for Bluetooth by including NSBluetoothAlwaysUsageDescription in their info.plist file. 
    Otherwise accessing any Core Bluetooth APIs would lead to a crash. For backward support for older iOS versions, NSBluetoothPeripheralUsageDescription needs to be defined.
platforms: [android, iphone, ipad] 

properties:
  - name: AUTHORISATION_STATUS_NOT_DETERMINED
    type: Number
    summary: A state that indicates the user has yet to authorize Bluetooth for this app.
    permission: read-only
    platforms: [iphone, ipad]
    since: "1.0.0"
    value: 0

  - name: AUTHORISATION_STATUS_RESTRICTED
    type: Number
    summary: A state that indicates this app isn’t authorized to use Bluetooth.
    permission: read-only
    platforms: [iphone, ipad]
    since: "1.0.0"
    value: 1
    
  - name: AUTHORISATION_STATUS_DENIED
    type: Number
    summary: A state that indicates the user explicitly denied Bluetooth access for this app.
    permission: read-only
    platforms: [iphone, ipad]
    since: "1.0.0"
    value: 2
    
  - name: AUTHORISATION_STATUS_ALLOWED_ALWAYS
    type: Number
    summary: A state that indicates the user has authorized Bluetooth at any time.
    permission: read-only
    platforms: [iphone, ipad]
    since: "1.0.0"
    value: 3

  - name: ATTRIBUTE_PERMISSION_READABLE
    type: Number
    summary: A permission that indicates a peripheral can read the attribute’s value.
    permission: read-only
    platforms: [iphone, ipad]
    since: "1.0.0"
    value: 0
    
  - name: ATTRIBUTE_PERMISSION_WRITEABLE
    type: Number
    summary: A permission that indicates a peripheral can write the attribute’s value.
    permission: read-only
    platforms: [iphone, ipad]
    since: "1.0.0"
    value: 1

  - name: ATTRIBUTE_PERMISSION_READ_ENCRYPTION_REQUIRED
    type: Number
    summary: A permission that indicates only trusted devices can read the attribute’s value.
    permission: read-only
    platforms: [iphone, ipad]
    since: "1.0.0"
    value: 2

  - name: ATTRIBUTE_PERMISSION_WRITE_ENCRYPTION_REQUIRED
    type: Number
    summary: A permission that indicates only trusted devices can write the attribute’s value.
    permission: read-only
    platforms: [iphone, ipad]
    since: "1.0.0"
    value: 3

  - name: CHARACTERISTIC_PROPERTIES_BROADCAST
    type: Number
    summary: A property that indicates the characteristic can broadcast its value using a characteristic configuration descriptor.
    permission: read-only
    platforms: [iphone, ipad]
    since: "1.0.0"
    value: 0

  - name: CHARACTERISTIC_PROPERTIES_READ
    type: Number
    summary: A property that indicates a peripheral can read the characteristic’s value.
    permission: read-only
    platforms: [iphone, ipad]
    since: "1.0.0"
    value: 1

  - name: CHARACTERISTIC_PROPERTIES_WRITE_WITHOUT_RESPONSE
    type: Number
    summary: A property that indicates a peripheral can write the characteristic's value, without a response to indicate that the write succeeded.
    permission: read-only
    platforms: [iphone, ipad]
    since: "1.0.0"
    value: 2

  - name: CHARACTERISTIC_PROPERTIES_WRITE
    type: Number
    summary: A property that indicates a peripheral can write the characteristic’s value, with a response to indicate that the write succeeded.
    permission: read-only
    platforms: [iphone, ipad]
    since: "1.0.0"
    value: 3

  - name: CHARACTERISTIC_PROPERTIES_NOTIFY
    type: Number
    summary: A property that indicates the peripheral permits notifications of the characteristic’s value, without a response from the central to indicate receipt of the notification.
    permission: read-only
    platforms: [iphone, ipad]
    since: "1.0.0"
    value: 4

  - name: CHARACTERISTIC_PROPERTIES_INDICATE
    type: Number
    summary: A property that indicates the peripheral permits notifications of the characteristic’s value, with a response from the central to indicate receipt of the notification.
    permission: read-only
    platforms: [iphone, ipad]
    since: "1.0.0"
    value: 5

  - name: CHARACTERISTIC_PROPERTIES_AUTHENTICATED_SIGNED_WRITES
    type: Number
    summary: A property that indicates the perhipheral allows signed writes of the characteristic’s value, without a response to indicate the write succeeded.
    permission: read-only
    platforms: [iphone, ipad]
    since: "1.0.0"
    value: 6

  - name: CHARACTERISTIC_PROPERTIES_EXTENDED_PROPERTIES
    type: Number
    summary: A property that indicates the characteristic defines additional properties in the extended properties descriptor.A property that indicates the characteristic defines additional properties in the extended properties descriptor.
    permission: read-only
    platforms: [iphone, ipad]
    since: "1.0.0"
    value: 7

  - name: CHARACTERISTIC_PROPERTIES_NOTIFY_ENCRYPTION_REQUIRED
    type: Number
    summary: A property that indicates that only trusted devices can enable notifications of the characteristic’s value.
    permission: read-only
    platforms: [iphone, ipad]
    since: "1.0.0"
    value: 8

  - name: CHARACTERISTIC_PROPERTIES_INDICATE_ENCRYPTION_REQUIRED
    type: Number
    summary: A property that indicates only trusted devices can enable indications of the characteristic’s value.
    permission: read-only
    platforms: [iphone, ipad]
    since: "1.0.0"
    value: 9

  - name: CBUUID_CHARACTERISTIC_EXTENDED_PROPERTIES_STRING
    type: String
    summary: The UUID for the Extended Properties descriptor, as a string. The corresponding value for this descriptor is an NSNumber object.
    permission: read-only
    platforms: [iphone, ipad]
    since: "1.0.0"
    value: 2900

  - name: CBUUID_CHARACTERISTIC_USER_DESCRIPTION_STRING
    type: String
    summary: The UUID for the User Description descriptor, as a string. The corresponding value for this descriptor is an NSString object.
    permission: read-only
    platforms: [iphone, ipad]
    since: "1.0.0"
    value: 2901

  - name: CBUUID_CLIENT_CHARACTERISTIC_CONFIGURATION_STRING
    type: String
    summary: The UUID for the Client Configuration descriptor, as a string. The corresponding value for this descriptor is an NSNumber object.
    permission: read-only
    platforms: [iphone, ipad]
    since: "1.0.0"
    value: 2902

  - name: CBUUID_SERVER_CHARACTERISTIC_CONFIGURATION_STRING
    type: String
    summary: The UUID for the Server Configuration descriptor, as a string. The corresponding value for this descriptor is an NSNumber object.
    permission: read-only
    platforms: [iphone, ipad]
    since: "1.0.0"
    value: 2903

  - name: CBUUID_CHARACTERISTIC_FORMAT_STRING
    type: String
    summary: The UUID for the Presentation Format descriptor, as a string. The corresponding value for this descriptor is an NSData object.
    permission: read-only
    platforms: [iphone, ipad]
    since: "1.0.0"
    value: 2904

  - name: CBUUID_CHARACTERISTIC_AGGREGATE_FORMAT_STRING
    type: String
    summary: The UUID for the Aggregate Format descriptor, as a string.
    permission: read-only
    platforms: [iphone, ipad]
    since: "1.0.0"
    value: 2905

  - name: CBUUID_L2CAPPSM_CHARACTERISTIC_STRING
    type: String
    summary: The PSM of an L2CAP channel associated with the GATT service containing this characteristic.This PSM is a little-endian UInt16. Servers can publish this characteristic with the UUID ABDD3056-28FA-441D-A470-55A75A52553A.
    permission: read-only
    platforms: [iphone, ipad]
    since: "1.0.0"
    value: 2906

  - name: PERIPHERAL_STATE_DISCONNECTED
    type: Number
    summary: The peripheral isn’t connected to the central manager.
    permission: read-only
    platforms: [iphone, ipad]
    since: "1.0.0"
    value: 0

  - name: PERIPHERAL_STATE_CONNECTING
    type: Number
    summary: The peripheral is in the process of connecting to the central manager.
    permission: read-only
    platforms: [iphone, ipad]
    since: "1.0.0"
    value: 1

  - name: PERIPHERAL_STATE_CONNECTED
    type: Number
    summary: The peripheral is connected to the central manager.
    permission: read-only
    platforms: [iphone, ipad]
    since: "1.0.0"
    value: 2

  - name: PERIPHERAL_STATE_DISCONNECTING
    type: Number
    summary: The peripheral is disconnecting from the central manager.
    permission: read-only
    platforms: [iphone, ipad]
    since: "1.0.0"
    value: 3  

  - name: CENTRAL_MANAGER_STATE_UNKNOWN
    type: Number
    summary: The manager’s state is unknown
    permission: read-only
    platforms: [iphone, ipad]
    since: "1.0.0"
    value: 0 

  - name: CENTRAL_MANAGER_STATE_RESETTING
    type: Number
    summary: A state that indicates the connection with the system service was momentarily lost.
    permission: read-only
    platforms: [iphone, ipad]
    since: "1.0.0"
    value: 1

  - name: CENTRAL_MANAGER_STATE_UNSUPPORTED
    type: Number
    summary: A state that indicates this device doesn’t support the Bluetooth low energy central or client role.
    permission: read-only
    platforms: [iphone, ipad]
    since: "1.0.0"
    value: 2

  - name: CENTRAL_MANAGER_STATE_UNAUTHORIZED
    type: Number
    summary: A state that indicates the application isn’t authorized to use the Bluetooth low energy role.
    permission: read-only
    platforms: [iphone, ipad]
    since: "1.0.0"
    value: 3

  - name: CENTRAL_MANAGER_STATE_POWERED_OFF
    type: Number
    summary: A state that indicates Bluetooth is currently powered off.
    permission: read-only
    platforms: [iphone, ipad]
    since: "1.0.0"
    value: 4
 
  - name: CENTRAL_MANAGER_STATE_POWERED_ON
    type: Number
    summary: A state that indicates Bluetooth is currently powered on and available to use.
    permission: read-only
    platforms: [iphone, ipad]
    since: "1.0.0"
    value: 5

  - name: CONNECTION_EVENT_TYPE_PEER_DISCONNECTED
    type: Number
    summary: Peer disconnect event type. This is 'event' type value for CENTREL_MANAGER_EVENT_PERIPHERAL_CONNECTION_EVENT_DID_OCCUR event.
    permission: read-only
    platforms: [iphone, ipad]
    since: "1.0.0"
    value: 0
 
  - name: CONNECTION_EVENT_TYPE_PEER_CONNECTED
    type: Number
    summary: Peer connected event type. This is 'event' type value for CENTREL_MANAGER_EVENT_PERIPHERAL_CONNECTION_EVENT_DID_OCCUR event.
    permission: read-only
    platforms: [iphone, ipad]
    since: "1.0.0"
    value: 1

  - name: CONNECT_PERIPHERAL_OPTIONS_KEY_NOTIFY_ON_CONNECTION
    type: String
    summary: A Boolean value that specifies whether the system should display an alert when connecting a peripheral in the background.
    description: |
       options object key used in Modules.BLE.CentralManager.connectPeripheral.
       The value for this key is an Boolean. This key is useful for apps that haven’t specified the bluetooth-central background mode and can’t display their own alert. 
       If more than one app requests a notification for a given peripheral, the one that was most recently in the foreground receives the alert. If the key isn’t specified,
       the default value is false.    
    permission: read-only
    platforms: [iphone, ipad]
    since: "1.0.0"

  - name: CONNECT_PERIPHERAL_OPTIONS_KEY_NOTIFY_ON_DISCONNECTION
    type: String
    summary: A Boolean value that specifies whether the system should display an alert when disconnecting a peripheral in the background.
    description: |
       options object key used in Modules.BLE.CentralManager.connectPeripheral.
       The value for this key is an Boolean. This key is useful for apps that haven’t specified the bluetooth-central background mode and can’t display their own alert. 
       If more than one app requests a notification for a given peripheral, the one that was most recently in the foreground receives the alert. If the key isn’t specified,
       the default value is false.
    permission: read-only
    platforms: [iphone, ipad]
    since: "1.0.0"

  - name: CONNECT_PERIPHERAL_OPTIONS_KEY_NOTIFY_ON_NOTIFICATION
    type: String
    summary: A Boolean value that specifies whether the system should display an alert for any notification sent by a peripheral.
    description: |
       options object key used in Modules.BLE.CentralManager.connectPeripheral.
       If true, the system displays an alert for all notifications received from a given peripheral while the app is suspended.
       the default value is false.
    permission: read-only
    platforms: [iphone, ipad]
    since: "1.0.0"

  - name: CONNECT_PERIPHERAL_OPTIONS_KEY_START_DELAY
    type: String
    summary: An option that indicates a delay before the system makes a connection.
    description: |
       options object key used in Modules.BLE.CentralManager.connectPeripheral.
       The corresponding value is an Number that indicates the duration of the delay in seconds.
    permission: read-only
    platforms: [iphone, ipad]
    since: "1.0.0"

  - name: CONNECT_PERIPHERAL_OPTIONS_KEY_ENABLE_TRANSPORT_BRIDGING
    type: String
    summary: An option to bridge classic Bluetooth technology profiles, if already connected over Bluetooth Low Energy.
    description: |
       options object key used in Modules.BLE.CentralManager.connectPeripheral.
       This option tells the system to connect non-GATT profiles on classic Bluetooth devices, if there is a low energy GATT connection to the same device.
       A true value instructs the system to bring up classic transport profiles when a low energy transport peripheral connects. A false value tells the system not to use the profiles.
    permission: read-only
    platforms: [iphone, ipad]
    since: "1.0.0"

  - name: CONNECT_PERIPHERAL_OPTIONS_KEY_REQUIRES_ANCS
    type: String
    summary: An option to require Apple Notification Center Service (ANCS) when connecting a device.
    description: |
       options object key used in Modules.BLE.CentralManager.connectPeripheral.
    permission: read-only
    platforms: [iphone, ipad]
    since: "1.0.0"

  - name: ADVERTISEMENT_DATA_KEY_SERVICE_DATA
    type: String
    summary: A dictionary that contains service-specific advertisement data.
    description: |
       The keys (Strings objects) represent Service UUIDs, and the values (TiBuffer objects) represent service-specific data.
    permission: read-only
    platforms: [iphone, ipad]
    since: "1.0.0"

  - name: ADVERTISEMENT_DATA_KEY_LOCAL_NAME_KEY
    type: String
    summary: The local name of a peripheral.
    description: |
       The value associated with this key is an String.
    permission: read-only
    platforms: [iphone, ipad]
    since: "1.0.0"

  - name: ADVERTISEMENT_DATA_KEY_MANUFACTURER_DATA
    type: String
    summary: The manufacturer data of a peripheral.
    description: |
       The value associated with this key is an TiBuffer object.
    permission: read-only
    platforms: [iphone, ipad]
    since: "1.0.0"

  - name: ADVERTISEMENT_DATA_KEY_SERVICE_UUIDS
    type: String
    summary: An array of service UUIDs.
    description: |
       The value associated with this key is an Array<String> object.
    permission: read-only
    platforms: [iphone, ipad]
    since: "1.0.0"

  - name: ADVERTISEMENT_DATA_KEY_OVERFLOW_SERVICE_UUIDS
    type: String
    summary: An array of UUIDs found in the overflow area of the advertisement data.
    description: |
       The value associated with this key is an array of one or more String objects, representing Service UUIDs.
       Because data stored in this area results from not fitting in the main advertisement, UUIDs listed here are “best effort” and may not always be accurate. For details about the overflow area of advertisement data, see the startAdvertising(_:) method in PeripheralManager.
    permission: read-only
    platforms: [iphone, ipad]
    since: "1.0.0"

  - name: ADVERTISEMENT_DATA_KEY_TX_POWER_LEVEL
    type: String
    summary: The transmit power of a peripheral.
    description: |
       The value associated with this key is an instance of Number.
       This key and value are available if the peripheral provides its transmitting power level in its advertising packet. You can calculate the path loss by comparing the RSSI value with the transmitting power level.
    permission: read-only
    platforms: [iphone, ipad]
    since: "1.0.0"

  - name: ADVERTISEMENT_DATA_KEY_IS_CONNECTABLE
    type: String
    summary: A Boolean value that indicates whether the advertising event type is connectable.
    description: |
       The value for this key is an Number object. You can use this value to determine whether your app can currently connect to a peripheral.
    permission: read-only
    platforms: [iphone, ipad]
    since: "1.0.0"

  - name: ADVERTISEMENT_DATA_KEY_SOLICITED_SERVICE_UUIDS
    type: String
    summary: An array of solicited service UUIDs.
    description: |
       The value associated with this key is an array of one or more String objects, representing Service UUIDs.
    permission: read-only
    platforms: [iphone, ipad]
    since: "1.0.0"

methods:
  - name: addService
    summary: Publishes a service and any of its associated characteristics and characteristic descriptors to the local GATT database.
    platforms: [iphone, ipad]
    since: "1.0.0"
    parameters:
      - name: data
        type: Object
        summary: The value of the characteristic.
      - name: properties
        type: Number
        summary: The properties of the characteristic. 
      - name: permissions
        type: Number
        summary: The permissions of the characteristic value.
      - name: characteristics
        type: Array<Modules.BLE.Characteristic>
        summary: A list of characteristics of a service.
      - name: uuid
        type: String
        summary: The Bluetooth-specific UUID of the attribute.
      - name: primary
        type: Number
        summary: The properties of the characteristic. 
    returns:
      type: Modules.BLE.Service
      summary: Object of service which is added.

  - name: removeServices
    summary: Removes a specified published service from the local GATT database.
    platforms: [iphone, ipad]
    since: "1.0.0"
    parameters:
      - name: service
        type: Modules.BLE.Service
        summary: Object of service you want to remove.
    returns:
      type: void

  - name: removeAllServices
    summary: Removes all published services from the local GATT database.
    platforms: [iphone, ipad]
    since: "1.0.0"
    returns:
      type: void

  - name: initCentralManager
    summary: Removes all published services from the local GATT database.
    platforms: [iphone, ipad]
    since: "1.0.0"
    parameters:
      - name: showPowerAlert
        type: Boolean
        summary: A Boolean value that specifies whether the system warns the user if the app instantiates the central manager when Bluetooth service isn’t available.
      - name: restoreIdentifier
        type: String
        summary: A string containing a unique identifier (UID) for the central manager to instantiate.
    returns:
      type: Modules.BLE.CentralManager
