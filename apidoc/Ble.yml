---
name: Modules.BLE
extends: Titanium.Module
summary: Add-on Bluetooth Low Energy module
since: "1.0.0"
description: |
    Using Bluetooth Low Energy module is used to interact with Bluetooth Low Energy (BLE) devices.
    Note (IOS): Starting iOS 13, it's mandatory for developers to specify the Privacy Usage Description for Bluetooth by including NSBluetoothAlwaysUsageDescription in their info.plist file. 
    Otherwise accessing any Core Bluetooth APIs would lead to a crash. For backward support for older iOS versions, NSBluetoothPeripheralUsageDescription needs to be defined.
platforms: [android, iphone, ipad] 

properties:
  - name: AUTHORISATION_STATUS_NOT_DETERMINED
    type: Number
    summary: A state that indicates the user has yet to authorize Bluetooth for this app.
    permission: read-only
    platforms: [iphone, ipad]
    since: "1.0.0"
    value: 0

  - name: AUTHORISATION_STATUS_RESTRICTED
    type: Number
    summary: A state that indicates this app isn’t authorized to use Bluetooth.
    permission: read-only
    platforms: [iphone, ipad]
    since: "1.0.0"
    value: 1
    
  - name: AUTHORISATION_STATUS_DENIED
    type: Number
    summary: A state that indicates the user explicitly denied Bluetooth access for this app.
    permission: read-only
    platforms: [iphone, ipad]
    since: "1.0.0"
    value: 2
    
  - name: AUTHORISATION_STATUS_ALLOWED_ALWAYS
    type: Number
    summary: A state that indicates the user has authorized Bluetooth at any time.
    permission: read-only
    platforms: [iphone, ipad]
    since: "1.0.0"
    value: 3

  - name: ATTRIBUTE_PERMISSION_READABLE
    type: Number
    summary: A permission that indicates a peripheral can read the attribute’s value.
    permission: read-only
    platforms: [iphone, ipad]
    since: "1.0.0"
    value: 0
    
  - name: ATTRIBUTE_PERMISSION_WRITEABLE
    type: Number
    summary: A permission that indicates a peripheral can write the attribute’s value.
    permission: read-only
    platforms: [iphone, ipad]
    since: "1.0.0"
    value: 1

  - name: ATTRIBUTE_PERMISSION_READ_ENCRYPTION_REQUIRED
    type: Number
    summary: A permission that indicates only trusted devices can read the attribute’s value.
    permission: read-only
    platforms: [iphone, ipad]
    since: "1.0.0"
    value: 2

  - name: ATTRIBUTE_PERMISSION_WRITE_ENCRYPTION_REQUIRED
    type: Number
    summary: A permission that indicates only trusted devices can write the attribute’s value.
    permission: read-only
    platforms: [iphone, ipad]
    since: "1.0.0"
    value: 3

  - name: CHARACTERISTIC_PROPERTIES_BROADCAST
    type: Number
    summary: A property that indicates the characteristic can broadcast its value using a characteristic configuration descriptor.
    permission: read-only
    platforms: [iphone, ipad]
    since: "1.0.0"
    value: 0

  - name: CHARACTERISTIC_PROPERTIES_READ
    type: Number
    summary: A property that indicates a peripheral can read the characteristic’s value.
    permission: read-only
    platforms: [iphone, ipad]
    since: "1.0.0"
    value: 1

  - name: CHARACTERISTIC_PROPERTIES_WRITE_WITHOUT_RESPONSE
    type: Number
    summary: A property that indicates a peripheral can write the characteristic's value, without a response to indicate that the write succeeded.
    permission: read-only
    platforms: [iphone, ipad]
    since: "1.0.0"
    value: 2

  - name: CHARACTERISTIC_PROPERTIES_WRITE
    type: Number
    summary: A property that indicates a peripheral can write the characteristic’s value, with a response to indicate that the write succeeded.
    permission: read-only
    platforms: [iphone, ipad]
    since: "1.0.0"
    value: 3

  - name: CHARACTERISTIC_PROPERTIES_NOTIFY
    type: Number
    summary: A property that indicates the peripheral permits notifications of the characteristic’s value, without a response from the central to indicate receipt of the notification.
    permission: read-only
    platforms: [iphone, ipad]
    since: "1.0.0"
    value: 4

  - name: CHARACTERISTIC_PROPERTIES_INDICATE
    type: Number
    summary: A property that indicates the peripheral permits notifications of the characteristic’s value, with a response from the central to indicate receipt of the notification.
    permission: read-only
    platforms: [iphone, ipad]
    since: "1.0.0"
    value: 5

  - name: CHARACTERISTIC_PROPERTIES_AUTHENTICATED_SIGNED_WRITES
    type: Number
    summary: A property that indicates the perhipheral allows signed writes of the characteristic’s value, without a response to indicate the write succeeded.
    permission: read-only
    platforms: [iphone, ipad]
    since: "1.0.0"
    value: 6

  - name: CHARACTERISTIC_PROPERTIES_EXTENDED_PROPERTIES
    type: Number
    summary: A property that indicates the characteristic defines additional properties in the extended properties descriptor.A property that indicates the characteristic defines additional properties in the extended properties descriptor.
    permission: read-only
    platforms: [iphone, ipad]
    since: "1.0.0"
    value: 7

  - name: CHARACTERISTIC_PROPERTIES_NOTIFY_ENCRYPTION_REQUIRED
    type: Number
    summary: A property that indicates that only trusted devices can enable notifications of the characteristic’s value.
    permission: read-only
    platforms: [iphone, ipad]
    since: "1.0.0"
    value: 8

  - name: CHARACTERISTIC_PROPERTIES_INDICATE_ENCRYPTION_REQUIRED
    type: Number
    summary: A property that indicates only trusted devices can enable indications of the characteristic’s value.
    permission: read-only
    platforms: [iphone, ipad]
    since: "1.0.0"
    value: 9

  - name: CBUUID_CHARACTERISTIC_EXTENDED_PROPERTIES_STRING
    type: String
    summary: The UUID for the Extended Properties descriptor, as a string. The corresponding value for this descriptor is an NSNumber object.
    permission: read-only
    platforms: [iphone, ipad]
    since: "1.0.0"
    value: 2900

  - name: CBUUID_CHARACTERISTIC_USER_DESCRIPTION_STRING
    type: String
    summary: The UUID for the User Description descriptor, as a string. The corresponding value for this descriptor is an NSString object.
    permission: read-only
    platforms: [iphone, ipad]
    since: "1.0.0"
    value: 2901

  - name: CBUUID_CLIENT_CHARACTERISTIC_CONFIGURATION_STRING
    type: String
    summary: The UUID for the Client Configuration descriptor, as a string. The corresponding value for this descriptor is an NSNumber object.
    permission: read-only
    platforms: [iphone, ipad]
    since: "1.0.0"
    value: 2902

  - name: CBUUID_SERVER_CHARACTERISTIC_CONFIGURATION_STRING
    type: String
    summary: The UUID for the Server Configuration descriptor, as a string. The corresponding value for this descriptor is an NSNumber object.
    permission: read-only
    platforms: [iphone, ipad]
    since: "1.0.0"
    value: 2903

  - name: CBUUID_CHARACTERISTIC_FORMAT_STRING
    type: String
    summary: The UUID for the Presentation Format descriptor, as a string. The corresponding value for this descriptor is an NSData object.
    permission: read-only
    platforms: [iphone, ipad]
    since: "1.0.0"
    value: 2904

  - name: CBUUID_CHARACTERISTIC_AGGREGATE_FORMAT_STRING
    type: String
    summary: The UUID for the Aggregate Format descriptor, as a string.
    permission: read-only
    platforms: [iphone, ipad]
    since: "1.0.0"
    value: 2905

  - name: CBUUID_L2CAPPSM_CHARACTERISTIC_STRING
    type: String
    summary: The PSM of an L2CAP channel associated with the GATT service containing this characteristic.This PSM is a little-endian UInt16. Servers can publish this characteristic with the UUID ABDD3056-28FA-441D-A470-55A75A52553A.
    permission: read-only
    platforms: [iphone, ipad]
    since: "1.0.0"
    value: 2906

  - name: PERIPHERAL_STATE_DISCONNECTED
    type: Number
    summary: The peripheral isn’t connected to the central manager.
    permission: read-only
    platforms: [iphone, ipad]
    since: "1.0.0"
    value: 0

  - name: PERIPHERAL_STATE_CONNECTING
    type: Number
    summary: The peripheral is in the process of connecting to the central manager.
    permission: read-only
    platforms: [iphone, ipad]
    since: "1.0.0"
    value: 1

  - name: PERIPHERAL_STATE_CONNECTED
    type: Number
    summary: The peripheral is connected to the central manager.
    permission: read-only
    platforms: [iphone, ipad]
    since: "1.0.0"
    value: 2

  - name: PERIPHERAL_STATE_DISCONNECTING
    type: Number
    summary: The peripheral is disconnecting from the central manager.
    permission: read-only
    platforms: [iphone, ipad]
    since: "1.0.0"
    value: 3  

  - name: CENTREL_MANAGER_STATE_UNKNOWN
    type: Number
    summary: The manager’s state is unknown
    permission: read-only
    platforms: [iphone, ipad]
    since: "1.0.0"
    value: 0 

  - name: CENTREL_MANAGER_STATE_RESETTING
    type: Number
    summary: A state that indicates the connection with the system service was momentarily lost.
    permission: read-only
    platforms: [iphone, ipad]
    since: "1.0.0"
    value: 1

  - name: CENTREL_MANAGER_STATE_UNSUPPORTED
    type: Number
    summary: A state that indicates this device doesn’t support the Bluetooth low energy central or client role.
    permission: read-only
    platforms: [iphone, ipad]
    since: "1.0.0"
    value: 2

  - name: CENTREL_MANAGER_STATE_UNAUTHORIZED
    type: Number
    summary: A state that indicates the application isn’t authorized to use the Bluetooth low energy role.
    permission: read-only
    platforms: [iphone, ipad]
    since: "1.0.0"
    value: 3

  - name: CENTREL_MANAGER_STATE_POWERED_OFF
    type: Number
    summary: A state that indicates Bluetooth is currently powered off.
    permission: read-only
    platforms: [iphone, ipad]
    since: "1.0.0"
    value: 4
 
  - name: CENTREL_MANAGER_STATE_POWERED_ON
    type: Number
    summary: A state that indicates Bluetooth is currently powered on and available to use.
    permission: read-only
    platforms: [iphone, ipad]
    since: "1.0.0"
    value: 5

  - name: CENTREL_MANAGER_EVENT_STATE_UPDATED
    type: String
    summary: A event called when centrel manager state updated
    permission: read-only
    platforms: [iphone, ipad]
    since: "1.0.0"
    value: didUpdateState

  - name: CENTREL_MANAGER_EVENT_STATE_RESTORE
    type: String
    summary: A event called when centrel manager will restore state
    permission: read-only
    platforms: [iphone, ipad]
    since: "1.0.0"
    value: willRestoreState

  - name: CENTREL_MANAGER_EVENT_PERIPHERAL_DISCOVERED
    type: String
    summary: A event called when centrel manager discover peripheral
    permission: read-only
    platforms: [iphone, ipad]
    since: "1.0.0"
    value: didDiscoverPeripheral


methods:
  - name: addService
    summary: Publishes a service and any of its associated characteristics and characteristic descriptors to the local GATT database.
    platforms: [iphone, ipad]
    since: "1.0.0"
    parameters:
      - name: data
        type: Object
        summary: The value of the characteristic.
      - name: properties
        type: Number
        summary: The properties of the characteristic. 
      - name: permissions
        type: Number
        summary: The permissions of the characteristic value.
      - name: characteristics
        type: Array<Modules.BLE.Characteristic>
        summary: A list of characteristics of a service.
      - name: uuid
        type: String
        summary: The Bluetooth-specific UUID of the attribute.
      - name: primary
        type: Number
        summary: The properties of the characteristic. 
    returns:
      type: Modules.BLE.Service
      summary: Object of service which is added.

  - name: removeServices
    summary: Removes a specified published service from the local GATT database.
    platforms: [iphone, ipad]
    since: "1.0.0"
    parameters:
      - name: service
        type: Modules.BLE.Service
        summary: Object of service you want to remove.
    returns:
      type: void

  - name: removeAllServices
    summary: Removes all published services from the local GATT database.
    platforms: [iphone, ipad]
    since: "1.0.0"
    returns:
      type: void

  - name: initCentralManager
    summary: Removes all published services from the local GATT database.
    platforms: [iphone, ipad]
    since: "1.0.0"
    parameters:
      - name: showPowerAlert
        type: Boolean
        summary: A Boolean value that specifies whether the system warns the user if the app instantiates the central manager when Bluetooth service isn’t available.
      - name: restoreIdentifier
        type: String
        summary: A string containing a unique identifier (UID) for the central manager to instantiate.
    returns:
      type: Modules.BLE.CentralManager